<?php
/***************************************************
トップ画面

	mp	20141026	トップ画面作成




***************************************************/

/*smartyの呼び出し、smarty呼び出しの関数名は「$smarty_c」*/
include "./func/func.php";

/*env呼び出し*/
include "./env/env.inc";

/*データベース呼び出し*/
include "./func/dbh.php";











/**************************************************
ここから

クエリーの作成
↓
クエリーをカラム名に当てはめた配列に格納する（降順）

記事のカテゴリを調べることも念頭にここに備忘録として記載
select kiji.kiji_num, category_s.cate_s_name ,category.cate_name from kiji, cate_connect, category_s, category 
where
category.cate_no = category_s.cate_no
and
category_s.cate_no = cate_connect.cate_no
and
kiji.kiji_num = cate_connect.kiji_num



**************************************************/

//クエリーの作成
$q = "";								//クエリーの初期化
$q = "select kiji, kiji_num, kiji_date, kiji_title from kiji";		
$q.= " order by kiji_num desc ";

//カラム名に当てはめた配列に格納（function）

$test = queryarray($q);


/**************************************************
作成された配列

$kiji		⇒そのままつかう
$kiji_num	⇒URLに組み込むので編集する
$kiji_date	⇒そのまま
$kiji_title	⇒そのまま

**************************************************/

/*************************************************
$kiji_numをURLに組み込むためちょっと編集
内容としては

article.html?kiji_num=なんとかかんとか

を入れるようにする

urlencodeする対象⇒「kiji_num=」の下部分

**************************************************/

for($i=0; $i<count($kiji_num); $i++){
	//まず$aを初期化する
	$a = null;
	
	//リンクの下部分をまとめる

	$a =$kiji_num[$i];
	
	//次にhtmlspecialcharsしてからurlencodeして配列に格納
	$kijinumber[] = urlencode($a);
}



//tplにアサインする

$smarty_c -> assign("kiji_title",$kiji_title);		//記事のタイトル
$smarty_c -> assign("kiji_date",$kiji_date);		//記事の日時
$smarty_c -> assign("kiji",$kiji);			//記事内容
$smarty_c -> assign("kijinumber",$kijinumber);		//記事の続きのURL


$smarty_c -> display("../tpl/top.tpl");			//記事をテンプレートへ！！！！



//データベース切断
$dbh = null;

?>